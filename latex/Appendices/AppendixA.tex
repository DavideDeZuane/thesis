% Appendix A

\chapter{IKEv2 Notation} % Main appendix title

\label{AppendixA} % For referencing this appendix elsewhere, use \ref{AppendixA}

Riportare i vari approfondimenti riguardanti IKE

per esempio come vengono generate le varie chiavi e il significato delle informazioni presenti tra i messaggi


\subsection{Authentication}

L'autenticazione dei peer avviene effettuando il sign (o calcolando il MAC) di un payload che dipende dagli scambi precedenti.
In particolare questo payload è cmposto da un ottetto che viene autenticato in base alla modalità di aunteticazione scelta:

\begin{itemize}
    \item Nel caso di \textit{PubKey} questo viene firmato con la chiave privata del peer e ne viene allegato il certificato della chiave pubblica 
    \item Nel caso di \textit{PSK} l'AUTH payload viene generato a partire dalla chiave condivisa a cui viene aggiunge della unpredicability tramite del padding e una prf
\end{itemize}

\section{Key Derivation}

\subsection{IKE SA}

Le chiavi in una IKE SA vengono derivate a partire dagli attributi dei dirrenti scambi.
In particolare al termine del primo scambio viene calcolato il:

$$SKEYSEED=PRF(N_i|N_r,g^{ir})$$

A partire da questo sidder vengono generati i prametri di sicurezza da utililizzare per la IKE SA, questi sono derivati nel seguente modo:

$$\{SK_{d} | SK_{ai} | SK_{ar} | SK_{ei} | SK_{er} | SK_{pi} | SK_{pr} \} = PRF+(SKEYSEED, N_i|N_r, SPI_i, SPI_r)$$

\begin{table}[htbp]
    \centering
    \begin{tabular}{ll}
        \toprule
        \textbf{Chiave} & \textbf{Descrizione} \\
        \midrule
        $SK_d$ & Utilizzata per generare il keymaterial per le CHILD\_SA \\
        $SK_{a}$ & Chiavi per autenticare gli scambi successivi, una per direzione \\
        $SK_{e}$ & Chiavi per cifrare gli scambi successivi, una per direzione \\
        $SK_{p}$ & Chiavi utilizzata per generare l'AUTH Payload, una per direzione \\
        \bottomrule
    \end{tabular}
    \caption{Chiavi e loro utilizzo}
\end{table}

\subsection{IPsec SA}

Nel caso di una SA questa può essere generata automaticamente dopo l'auth oppure attraverso l'apposito scambio di questo tipo il keymaterial a partire dal quale vengono derivati i parametri di sicurezza è ottenuto nel seguente modo:

$$KEYMAT=prf+(SK_d,  N_i|N_r)$$

Nel caso in cui invece si utilizza lo scambio apposito il key material è ottenuto nel seguente modo


\section{Security Association Payload}

Il Security Association Payload denotato con $SA$ è utlilizzatoper negoziare gli attributi di una Secuiry Association. 
Dunque può contenere molteplici proposte, le quali devono essere ordinate per preferenza, ogni proposal contiene i seguenti algoritmi crittografici:

\begin{itemize}
    \item Encryption Algorithm (ENCR)
    \item Preudorandom Function (PRF)
    \item Integrity Algorithm (INTEG)
    \item Diffie-Hellman Group (KE)
    \item PQ KEM 
\end{itemize}
